!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("three")):"function"==typeof define&&define.amd?define(["three"],i):((t=t||self).THREE=t.THREE||{},t.THREE.TextTexture=i(t.THREE))}(this,function(t){"use strict";function i(t){return void 0===t}function e(t,i,e,n,r){return[t,i,e,n+"px",r].join(" ")}function n(t,i,e){if(i.length){var n=t().getContext("2d");return n.font=e,i.map(function(t){return n.measureText(t).width}).reduce(function(t,i){return Math.max(t,i)})}return 0}return function(r){function o(i){void 0===i&&(i={});var n=i.align;void 0===n&&(n="center");var o=i.anisotropy,s=i.createCanvas;void 0===s&&(s=function(){return document.createElement("canvas")});var h=i.fillStyle;void 0===h&&(h="#fff");var l=i.fontFamily;void 0===l&&(l="sans-serif");var a=i.fontSize;void 0===a&&(a=16);var f=i.fontStyle;void 0===f&&(f="normal");var d=i.fontVariant;void 0===d&&(d="normal");var u=i.fontWeight;void 0===u&&(u="normal");var g=i.format,c=i.lineGap;void 0===c&&(c=.15);var x=i.loadFontFace;void 0===x&&(x=function(t,i,n,r){var o=e(i,n,r,1,t);return document.fonts.load(o)});var _=i.magFilter;void 0===_&&(_=t.LinearFilter);var p=i.mapping,v=i.minFilter;void 0===v&&(v=t.LinearFilter);var y=i.padding;void 0===y&&(y=.25);var S=i.strokeStyle;void 0===S&&(S="#000");var P=i.strokeWidth;void 0===P&&(P=0);var W=i.text;void 0===W&&(W="");var I,m,k=i.type,w=i.wrapS,b=i.wrapT;r.call(this,s(),p,w,b,_,v,g,k,o),this._align=n,this._fillStyle=h,this._fontFamily=l,this._fontSize=a,this._fontStyle=f,this._fontVariant=d,this._fontWeight=u,this._lineGap=c,this._padding=y,this._strokeStyle=S,this._strokeWidth=P,this._text=W,this.createCanvas=s,this.loadFontFace=x,this.redraw=(I=this.redrawNow,function(){for(var t=this,i=[],e=arguments.length;e--;)i[e]=arguments[e];return m||(m=new Promise(function(t){setTimeout(t,0)}).then(function(){return I.apply(t,i)}).finally(function(){m=void 0})),m}),this.redrawNow()}r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o;var s={text:{configurable:!0},lines:{configurable:!0},fontFamily:{configurable:!0},fontSize:{configurable:!0},fontWeight:{configurable:!0},fontVariant:{configurable:!0},fontStyle:{configurable:!0},font:{configurable:!0},fillStyle:{configurable:!0},strokeWidth:{configurable:!0},strokeWidthInPixels:{configurable:!0},strokeStyle:{configurable:!0},align:{configurable:!0},lineGap:{configurable:!0},lineGapInPixels:{configurable:!0},padding:{configurable:!0},paddingInPixels:{configurable:!0},textWidthInPixels:{configurable:!0},textHeight:{configurable:!0},textHeightInPixels:{configurable:!0},widthInPixels:{configurable:!0},height:{configurable:!0},heightInPixels:{configurable:!0}};return s.text.get=function(){return this._text},s.text.set=function(t){this._text!==t&&(this._text=t,this._lines=void 0,this._textWidthInPixels=void 0,this.redraw())},s.lines.get=function(){var t;return i(this._lines)&&(this._lines=(t=this.text)?t.split("\n"):[]),this._lines},s.fontFamily.get=function(){return this._fontFamily},s.fontFamily.set=function(t){this._fontFamily!==t&&(this._fontFamily=t,this._textWidthInPixels=void 0,this.redraw())},s.fontSize.get=function(){return this._fontSize},s.fontSize.set=function(t){this._fontSize!==t&&(this._fontSize=t,this._textWidthInPixels=void 0,this.redraw())},s.fontWeight.get=function(){return this._fontWeight},s.fontWeight.set=function(t){this._fontWeight!==t&&(this._fontWeight=t,this._textWidthInPixels=void 0,this.redraw())},s.fontVariant.get=function(){return this._fontVariant},s.fontVariant.set=function(t){this._fontVariant!==t&&(this._fontVariant=t,this._textWidthInPixels=void 0,this.redraw())},s.fontStyle.get=function(){return this._fontStyle},s.fontStyle.set=function(t){this._fontStyle!==t&&(this._fontStyle=t,this._textWidthInPixels=void 0,this.redraw())},s.font.get=function(){return e(this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily)},s.fillStyle.get=function(){return this._fillStyle},s.fillStyle.set=function(t){this._fillStyle!==t&&(this._fillStyle=t,this.redraw())},s.strokeWidth.get=function(){return this._strokeWidth},s.strokeWidth.set=function(t){this._strokeWidth!==t&&(this._strokeWidth=t,this.redraw())},s.strokeWidthInPixels.get=function(){return this._strokeWidth*this.fontSize},s.strokeStyle.get=function(){return this._strokeStyle},s.strokeStyle.set=function(t){this._strokeStyle!==t&&(this._strokeStyle=t,this.redraw())},s.align.get=function(){return this._align},s.align.set=function(t){this._align!==t&&(this._align=t,this.redraw())},s.lineGap.get=function(){return this._lineGap},s.lineGap.set=function(t){this._lineGap!==t&&(this._lineGap=t,this.redraw())},s.lineGapInPixels.get=function(){return this.fontSize*this.lineGap},s.padding.get=function(){return this._padding},s.padding.set=function(t){this._padding!==t&&(this._padding=t,this.redraw())},s.paddingInPixels.get=function(){return this.padding*this.fontSize},s.textWidthInPixels.get=function(){return i(this._textWidthInPixels)&&(this._textWidthInPixels=n(this.createCanvas,this.lines,this.font)),this._textWidthInPixels},s.textHeight.get=function(){return this.lines.length?this.lines.length+this.lineGap*(this.lines.length-1):0},s.textHeightInPixels.get=function(){return this.textHeight*this.fontSize},s.widthInPixels.get=function(){return this.textWidthInPixels+this.strokeWidthInPixels+2*this.paddingInPixels},s.height.get=function(){return this.textHeight+this.strokeWidth+2*this.padding},s.heightInPixels.get=function(){return this.height*this.fontSize},o.prototype.redrawNow=function(){var t=this;return Promise.resolve().then(function(){return t.loadFontFace(t.fontFamily,t.fontStyle,t.fontVariant,t.fontWeight)}).then(function(){var i=t.image,e=i.getContext("2d");if(e.clearRect(0,0,i.width,i.height),t.widthInPixels&&t.heightInPixels){var n;switch(i.width=t.widthInPixels,i.height=t.heightInPixels,e.font=t.font,e.textBaseline="middle",t.align){case"left":e.textAlign="left",n=t.paddingInPixels+t.strokeWidthInPixels/2;break;case"right":e.textAlign="right",n=t.paddingInPixels+t.strokeWidthInPixels/2+t.textWidthInPixels;break;case"center":e.textAlign="center",n=t.paddingInPixels+t.strokeWidthInPixels/2+t.textWidthInPixels/2}var r=t.paddingInPixels+t.strokeWidthInPixels/2+t.fontSize/2;e.fillStyle=t.fillStyle,e.miterLimit=1,e.lineWidth=t.strokeWidthInPixels,e.strokeStyle=t.strokeStyle,t.lines.forEach(function(i){t.strokeWidthInPixels&&e.strokeText(i,n,r),e.fillText(i,n,r),r+=t.fontSize+t.lineGapInPixels})}else i.width=i.height=1;t.needsUpdate=!0})},Object.defineProperties(o.prototype,s),o}(t.Texture)});
